services:
  umami-db:
    image: postgres:16-alpine
    container_name: umami-db
    restart: unless-stopped

    environment:
      - POSTGRES_USER=umami
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
      - POSTGRES_DB=umami

    volumes:
      - /home/junghan/docker-data/umami/db:/var/lib/postgresql/data

    networks:
      - umami-internal

  umami:
    image: ghcr.io/umami-software/umami:postgresql-latest
    container_name: umami
    restart: unless-stopped
    depends_on:
      - umami-db

    environment:
      - DATABASE_URL=postgresql://umami:${POSTGRES_PASSWORD}@umami-db:5432/umami
      - APP_SECRET=${APP_SECRET}

    networks:
      - umami-internal
      - proxy          # Caddy 리버스 프록시 접근용

networks:
  umami-internal:
    driver: bridge
  proxy:
    external: true
