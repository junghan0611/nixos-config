services:
  remark42:
    image: ghcr.io/umputun/remark42:latest
    container_name: "remark42"
    hostname: "remark42"
    restart: always

    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "5"

    # 포트 직접 노출 없음 — Caddy 리버스 프록시가 처리
    expose:
      - "8080"

    environment:
      - REMARK_URL=https://comments.junghanacs.com
      - SECRET=${SECRET}
      - SITE=notes,www
      # SSL은 Caddy가 처리
      - SSL_TYPE=none
      - ALLOWED_HOSTS=comments.junghanacs.com,notes.junghanacs.com,www.junghanacs.com
      # Auth providers
      - AUTH_GITHUB_CID=${AUTH_GITHUB_CID}
      - AUTH_GITHUB_CSEC=${AUTH_GITHUB_CSEC}
      - AUTH_GOOGLE_CID=${AUTH_GOOGLE_CID}
      - AUTH_GOOGLE_CSEC=${AUTH_GOOGLE_CSEC}
      - AUTH_TELEGRAM=true
      - TELEGRAM_TOKEN=${TELEGRAM_TOKEN}
      - AUTH_ANON=true
      # Admin
      - ADMIN_SHARED_ID=${ADMIN_SHARED_ID}
      - ADMIN_SHARED_EMAIL=${ADMIN_SHARED_EMAIL}

    volumes:
      - ./var:/srv/var

    networks:
      - proxy

networks:
  proxy:
    external: true   # Caddy가 생성한 네트워크
