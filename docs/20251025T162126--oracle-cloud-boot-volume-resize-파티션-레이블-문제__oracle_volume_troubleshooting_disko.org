#+title:      Oracle Cloud Boot Volume Resize íŒŒí‹°ì…˜ ë ˆì´ë¸” ë¬¸ì œ
#+date:       [2025-10-25 Fri 16:21]
#+filetags:   :oracle:volume:troubleshooting:disko:
#+identifier: 20251025T162126

* Oracle Cloud Boot Volume Resize íŒŒí‹°ì…˜ ë ˆì´ë¸” ë¬¸ì œ :TROUBLESHOOTING:
:PROPERTIES:
:UPDATED: [2025-10-27 Mon 19:45]
:SOLVED: [2025-10-27 Mon] - UUID ê¸°ë°˜ ë§ˆìš´íŠ¸ë¡œ ì˜êµ¬ í•´ê²°
:END:

** ğŸ”´ ì¤‘ìš”: ì˜êµ¬ í•´ê²°ì±… (ë°˜ë“œì‹œ ë¨¼ì € ì ìš©!)

*** UUID ê¸°ë°˜ ë§ˆìš´íŠ¸ ì „í™˜ (Oracle Resize ì™„ì „ ë©´ì—­)

*laptopê³¼ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ í†µì¼* - íŒŒí‹°ì…˜ ë ˆì´ë¸” ì˜ì¡´ì„± ì™„ì „ ì œê±°

#+begin_src bash
# 1. UUID í™•ì¸
sudo blkid /dev/sda1  # boot: A085-2DF8
sudo blkid /dev/sda2  # root: 6ebf7d20-c186-4187-a8ab-30a92f293e24
#+end_src

#+begin_src nix
# hosts/oracle/hardware-configuration.nix
fileSystems."/" =
  { device = "/dev/disk/by-uuid/6ebf7d20-c186-4187-a8ab-30a92f293e24";
    fsType = "ext4";
  };

fileSystems."/boot" =
  { device = "/dev/disk/by-uuid/A085-2DF8";
    fsType = "vfat";
    options = [ "fmask=0022" "dmask=0022" ];
  };
#+end_src

#+begin_src bash
# ì ìš©
sudo nixos-rebuild switch
#+end_src

*ì´ì œ Volume resize/snapshot/migration ëª¨ë‘ ì•ˆì „!*

** ë¬¸ì œ ìƒí™©

*** ì¦ìƒ
Oracle Cloudì—ì„œ Boot Volumeì„ 100GBë¡œ resize í›„ ë¶€íŒ… ë¶ˆê°€ëŠ¥

#+begin_example
[TIME] Timed out waiting for device /dev/disk/by-partlabel/disk-main-root
[DEPEND] Dependency failed for File System /dev/disk/by-partlabel/disk-main-root
[DEPEND] Dependency failed for /sysroot
[DEPEND] Dependency failed for Initrd Root File System
#+end_example

*** í™˜ê²½
- í”Œë«í¼: Oracle Cloud Infrastructure (OCI)
- OS: NixOS 25.05 (aarch64-linux)
- ì´ˆê¸° ì„¤ì¹˜: Ubuntu 24.04 Minimal â†’ NixOS ì „í™˜
- ë””ìŠ¤í¬ ê´€ë¦¬: disko.nix
- Boot Volume: 100GB (resize ìˆ˜í–‰)

** ê·¼ë³¸ ì›ì¸ ë¶„ì„

*** ë³¼ë¥¨ ì œì–´ ê´€ì ì˜ í•µì‹¬ ë¬¸ì œ

*Oracle Cloud Volume Resizeì˜ ìœ„í—˜ì„±*

1. *ë³¼ë¥¨ ë ˆë²¨ vs íŒŒí‹°ì…˜ ë ˆë²¨ ë¶ˆì¼ì¹˜*
   - Oracleì€ Block Volume (ë³¼ë¥¨) í¬ê¸°ë§Œ í™•ì¥
   - íŒŒí‹°ì…˜ í…Œì´ë¸”ê³¼ íŒŒì¼ì‹œìŠ¤í…œì€ ìë™ ì¡°ì • ì•ˆ í•¨
   - ì‚¬ìš©ìê°€ ìˆ˜ë™ìœ¼ë¡œ íŒŒí‹°ì…˜ í™•ì¥ í•„ìš”

2. *GPT íŒŒí‹°ì…˜ ë ˆì´ë¸” ì†ì‹¤ ë©”ì»¤ë‹ˆì¦˜*
   #+begin_src bash
   # Oracle Volume Resize ê³¼ì •
   ë³¼ë¥¨ í¬ê¸° í™•ì¥ (50GB â†’ 100GB)
   â†’ GPT ë°±ì—… í—¤ë” ìœ„ì¹˜ ë³€ê²½ í•„ìš”
   â†’ íŒŒí‹°ì…˜ í…Œì´ë¸” ì¬êµ¬ì„± ì‹œë„
   â†’ íŒŒí‹°ì…˜ ë ˆì´ë¸”(name) ë©”íƒ€ë°ì´í„° ì†ì‹¤ ê°€ëŠ¥
   #+end_src

3. *Diskoì˜ íŒŒí‹°ì…˜ ë ˆì´ë¸” ì˜ì¡´ì„±*
   - DiskoëŠ” =/dev/disk/by-partlabel/disk-main-root= ê²½ë¡œ ì‚¬ìš©
   - ë ˆì´ë¸” ì†ì‹¤ â†’ initrdì—ì„œ ë£¨íŠ¸ íŒŒí‹°ì…˜ ì°¾ê¸° ì‹¤íŒ¨
   - UUIDë‚˜ device pathëŠ” ìœ ì§€ë˜ì§€ë§Œ ë ˆì´ë¸”ë§Œ ì‚¬ë¼ì§

*** ê¸°ìˆ ì  ì„¸ë¶€ì‚¬í•­

*íŒŒí‹°ì…˜ ì‹ë³„ ë°©ë²• 3ê°€ì§€*
| ë°©ë²•              | ê²½ë¡œ ì˜ˆì‹œ                                    | ì•ˆì •ì„± | Disko ê¸°ë³¸ê°’ |
|-------------------+----------------------------------------------+--------+--------------|
| Device Path       | =/dev/sda2=                                  | ë‚®ìŒ   | X            |
| UUID              | =/dev/disk/by-uuid/xxxxx=                    | ë†’ìŒ   | X            |
| Partition Label   | =/dev/disk/by-partlabel/disk-main-root=      | ì¤‘ê°„   | O (ê¸°ë³¸)     |

*ì™œ DiskoëŠ” Partition Labelì„ ì‚¬ìš©í•˜ëŠ”ê°€?*
- ê°€ë…ì„±: =disk-main-root= > =UUID=
- ì„ ì–¸ì  êµ¬ì„±: íŒŒí‹°ì…˜ ì´ë¦„ì„ ì½”ë“œë¡œ ê´€ë¦¬
- ì¬í˜„ì„±: ìƒˆ ë””ìŠ¤í¬ì— ë™ì¼í•œ ë ˆì´ë¸”ë¡œ ì¬êµ¬ì¶• ê°€ëŠ¥

*í•˜ì§€ë§Œ Oracle Cloudì—ì„œëŠ” ìœ„í—˜*
- Volume resizeê°€ ë ˆì´ë¸”ì„ ì‚­ì œí•  ìˆ˜ ìˆìŒ
- Live migration, snapshot restore ì‹œì—ë„ ìœ ì‚¬í•œ ë¬¸ì œ ê°€ëŠ¥

** Oracle Cloud ì ‘ê·¼ ë¬¸ì œ í•´ê²°

*** Serial Console ì ‘ê·¼ ë¶ˆê°€ ì›ì¸

*ì—ëŸ¬ ë©”ì‹œì§€*:
#+begin_example
Cannot open access to console, the root account is locked.
See sulogin(8) man page for more details.
#+end_example

*ê·¼ë³¸ ì›ì¸*:
- NixOS ê¸°ë³¸ ë³´ì•ˆ: root ê³„ì • ì ê¸ˆ (=passwd -l root= ìƒíƒœ)
- Emergency Mode: root ê¶Œí•œ í•„ìš”
- sulogin ì‹¤íŒ¨ â†’ ë¬´í•œ ë£¨í”„

*** í•´ê²° ë°©ì•ˆ: Boot Volumeì„ ë‹¤ë¥¸ Instanceì— Attach (ê¶Œì¥)

*ê°€ì¥ í™•ì‹¤í•œ ë³µêµ¬ ë°©ë²•*

#+begin_src bash
# === Oracle Cloud Console Web UIì—ì„œ ===

# 1. ë¬¸ì œ ìˆëŠ” ì¸ìŠ¤í„´ìŠ¤ ì¤‘ì§€
Compute â†’ Instances â†’ oracle-nixos â†’ Stop

# 2. Boot Volume Detach
Compute â†’ Instances â†’ oracle-nixos
â†’ Boot Volume â†’ Detach Boot Volume

# 3. ì„ì‹œ Ubuntu Instance ìƒì„±
Compute â†’ Instances â†’ Create Instance
â†’ Image: Ubuntu 24.04 Minimal (aarch64)
â†’ Availability Domain: ì›ë˜ instanceì™€ ë™ì¼í•˜ê²Œ ì„ íƒ
â†’ Shape: VM.Standard.A1.Flex (ë¬´ë£Œ í‹°ì–´)
â†’ SSH Key: ë³¸ì¸ í‚¤ ë“±ë¡

# 4. Boot Volumeì„ Block Volumeìœ¼ë¡œ Attach
Compute â†’ Block Storage â†’ Boot Volumes
â†’ ë¬¸ì œì˜ boot volume ì„ íƒ (oracle-nixos)
â†’ Attached Instances â†’ Attach to Instance
â†’ Instance: ë°©ê¸ˆ ë§Œë“  Ubuntu instance
â†’ Device Path: /dev/oracleoci/oraclevdb (ìë™ í• ë‹¹)
â†’ Access: Read/Write
â†’ Attach

# 5. Ubuntu instanceì— SSH ì ‘ì†
ssh ubuntu@<TEMP-INSTANCE-PUBLIC-IP>

# === Ubuntu Instance ë‚´ë¶€ì—ì„œ ===

# 6. ë””ë°”ì´ìŠ¤ í™•ì¸
lsblk
# NAME                  MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
# sda                     8:0    0   50G  0 disk    <- Ubuntu boot
# oracleoci-oraclevdb   252:0    0  100G  0 disk    <- NixOS boot (ë¬¸ì œ ë””ìŠ¤í¬)
# â”œâ”€oraclevdb1          252:1    0  512M  0 part
# â””â”€oraclevdb2          252:2    0 99.5G  0 part

# 7. ë§ˆìš´íŠ¸
sudo mkdir -p /mnt/nixos-root /mnt/nixos-boot
sudo mount /dev/oracleoci/oraclevdb2 /mnt/nixos-root  # root íŒŒí‹°ì…˜
sudo mount /dev/oracleoci/oraclevdb1 /mnt/nixos-boot  # boot íŒŒí‹°ì…˜

# 8. íŒŒí‹°ì…˜ ë ˆì´ë¸” í™•ì¸
sudo sgdisk -p /dev/oracleoci/oraclevdb
# ë ˆì´ë¸”ì´ ì—†ëŠ”ì§€ í™•ì¸ (Name ì»¬ëŸ¼ ë¹„ì–´ìˆìŒ)

# 9. íŒŒí‹°ì…˜ ë ˆì´ë¸” ë³µêµ¬ â­
sudo sgdisk -c 1:disk-main-boot /dev/oracleoci/oraclevdb
sudo sgdisk -c 2:disk-main-root /dev/oracleoci/oraclevdb
sudo partprobe /dev/oracleoci/oraclevdb

# 10. ë³µêµ¬ í™•ì¸
ls -la /dev/disk/by-partlabel/
# disk-main-boot -> ../../oraclevdb1
# disk-main-root -> ../../oraclevdb2

# 11. (ì„ íƒ) root ë¹„ë°€ë²ˆí˜¸ ì„¤ì •ìœ¼ë¡œ Emergency Mode ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ
sudo mount --bind /dev /mnt/nixos-root/dev
sudo mount --bind /proc /mnt/nixos-root/proc
sudo mount --bind /sys /mnt/nixos-root/sys
sudo chroot /mnt/nixos-root
passwd root  # ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ ì„¤ì • (ì˜ˆ: recovery123)
exit

# 12. ì–¸ë§ˆìš´íŠ¸
sudo umount /mnt/nixos-root/{dev,proc,sys}
sudo umount /mnt/nixos-boot /mnt/nixos-root

# === Oracle Cloud Consoleë¡œ ëŒì•„ê°€ê¸° ===

# 13. Volume Detach
Compute â†’ Block Storage â†’ Boot Volumes
â†’ ë³µêµ¬í•œ boot volume ì„ íƒ
â†’ Attached Instances â†’ Detach

# 14. ì›ë˜ Instanceì— Boot Volume ì¬ì—°ê²°
Compute â†’ Instances â†’ oracle-nixos
â†’ Boot Volume â†’ Attach Boot Volume
â†’ ë³µêµ¬í•œ boot volume ì„ íƒ

# 15. Instance ì‹œì‘
Compute â†’ Instances â†’ oracle-nixos â†’ Start

# 16. ë¶€íŒ… í™•ì¸
ssh junghan@<ORACLE-NIXOS-PUBLIC-IP>

# 17. ì„ì‹œ Ubuntu Instance ì‚­ì œ
Compute â†’ Instances â†’ temp-ubuntu â†’ Terminate
#+end_src

*** ëŒ€ì•ˆ: VNC Console ì‹œë„

Serial Console ëŒ€ì‹  VNC Console ì‚¬ìš©:

#+begin_src bash
# Oracle Cloud Consoleì—ì„œ:
Compute â†’ Instances â†’ oracle-nixos
â†’ More Actions â†’ Create Instance Console Connection
â†’ Connection Type: VNC
â†’ Create Console Connection
â†’ Copy Connection String
â†’ Launch VNC Console (ë¸Œë¼ìš°ì € ê¸°ë°˜)
#+end_src

*VNC Consoleì˜ ì¥ì *:
- Serial Consoleë³´ë‹¤ ë” ì§ì ‘ì ì¸ í•˜ë“œì›¨ì–´ ì ‘ê·¼
- ê·¸ë˜í”½ í„°ë¯¸ë„ ì§€ì›
- Root ì ê¸ˆ ë¬¸ì œ ìš°íšŒ ê°€ëŠ¥ì„± ìˆìŒ

** í•´ê²° ë°©ì•ˆ (ë¶€íŒ… ê°€ëŠ¥í•œ í™˜ê²½ì—ì„œ)

*** ë°©ì•ˆ 1: íŒŒí‹°ì…˜ ë ˆì´ë¸” ë³µêµ¬ (ì¦‰ì‹œ ë³µêµ¬ìš©)

*ì •ìƒ ë¶€íŒ… ê°€ëŠ¥í•˜ê±°ë‚˜ ìœ„ ë°©ë²•ìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•  ë•Œ*

#+begin_src bash
# 1. í˜„ì¬ íŒŒí‹°ì…˜ ìƒíƒœ í™•ì¸
sudo fdisk -l /dev/sda
sudo blkid /dev/sda*

# 2. GPT íŒŒí‹°ì…˜ ë ˆì´ë¸” í™•ì¸
sudo sgdisk -p /dev/sda

# 3. íŒŒí‹°ì…˜ ë ˆì´ë¸”ì´ ì—†ìœ¼ë©´ ë³µêµ¬
sudo sgdisk -c 1:disk-main-boot /dev/sda    # /boot íŒŒí‹°ì…˜ (EFI)
sudo sgdisk -c 2:disk-main-root /dev/sda    # / íŒŒí‹°ì…˜ (ë£¨íŠ¸)

# 4. íŒŒí‹°ì…˜ í…Œì´ë¸” ë³€ê²½ì‚¬í•­ ì»¤ë„ì— ì¦‰ì‹œ ì ìš©
sudo partprobe /dev/sda

# 5. ë³µêµ¬ í™•ì¸
ls -la /dev/disk/by-partlabel/
# disk-main-boot -> ../../sda1
# disk-main-root -> ../../sda2 ê°€ ë³´ì—¬ì•¼ í•¨

# 6. ë¦¬ë¶€íŒ…
sudo reboot
#+end_src

*ì£¼ì˜ì‚¬í•­*:
- =-c= ì˜µì…˜: partition number:label í˜•ì‹
- =sda1= = boot (EFI), =sda2= = root ìˆœì„œ í™•ì¸ í•„ìˆ˜
- =partprobe= ì‹¤íŒ¨ ì‹œ ì‹œìŠ¤í…œ ì¬ë¶€íŒ… í•„ìš”

*** ë°©ì•ˆ 2: UUID ê¸°ë°˜ ë§ˆìš´íŠ¸ë¡œ ì „í™˜ (ê¶Œì¥, ì˜êµ¬ í•´ê²°)

*1ë‹¨ê³„: UUID í™•ì¸*
#+begin_src bash
# Cloud Shell ë˜ëŠ” Live CDì—ì„œ
sudo blkid /dev/sda1  # boot UUID í™•ì¸
sudo blkid /dev/sda2  # root UUID í™•ì¸
#+end_src

*2ë‹¨ê³„: hardware-configuration.nix ìˆ˜ì •*
#+begin_src nix
# hosts/oracle/hardware-configuration.nix
{ config, lib, pkgs, modulesPath, ... }:

{
  imports = [ (modulesPath + "/profiles/qemu-guest.nix") ];

  boot.initrd.availableKernelModules = [ "xhci_pci" "virtio_pci" "virtio_scsi" "usbhid" ];
  boot.initrd.kernelModules = [ ];
  boot.kernelModules = [ ];
  boot.extraModulePackages = [ ];

  # UUID ê¸°ë°˜ íŒŒì¼ì‹œìŠ¤í…œ ë§ˆìš´íŠ¸ (ë ˆì´ë¸” ì˜ì¡´ì„± ì œê±°)
  fileSystems."/" = {
    device = "/dev/disk/by-uuid/YOUR-ROOT-UUID";  # blkidë¡œ í™•ì¸í•œ UUID
    fsType = "ext4";
    options = [ "defaults" "noatime" ];
  };

  fileSystems."/boot" = {
    device = "/dev/disk/by-uuid/YOUR-BOOT-UUID";  # blkidë¡œ í™•ì¸í•œ UUID
    fsType = "vfat";
    options = [ "defaults" ];
  };

  networking.useDHCP = lib.mkDefault true;
  nixpkgs.hostPlatform = lib.mkDefault "aarch64-linux";
}
#+end_src

*3ë‹¨ê³„: disk-config.nixëŠ” ìœ ì§€*
- =disk-config.nix= ëŠ” ì´ˆê¸° ì„¤ì¹˜ìš© (=nixos-install= ì‹œ ì‚¬ìš©)
- =hardware-configuration.nix= ê°€ ì‹¤ì œ ë¶€íŒ… ì‹œ ë§ˆìš´íŠ¸ ì œì–´
- DiskoëŠ” ì„¤ì¹˜ ì´í›„ì—ëŠ” ê´€ì—¬í•˜ì§€ ì•ŠìŒ

*ì¥ì *
- Oracle Volume ì‘ì—…ì— ì™„ì „íˆ ë…ë¦½ì 
- Resize, snapshot, migration ëª¨ë‘ ì•ˆì „
- UUIDëŠ” íŒŒí‹°ì…˜ ìƒì„± ì‹œ ìë™ ë¶€ì—¬ë˜ë©° ê±°ì˜ ë³€í•˜ì§€ ì•ŠìŒ

*** ë°©ì•ˆ 3: Emergency Mode ì ‘ê·¼ ê°œì„  (ê¶Œì¥ ì„¤ì •)

*NixOS Configurationì— ì¶”ê°€*

#+begin_src nix
# hosts/oracle/configuration.nix

{
  # Emergency shell ì ‘ê·¼ì„ ìœ„í•œ root ê³„ì • í™œì„±í™”
  # ë³´ì•ˆ: SSHëŠ” ì—¬ì „íˆ ë¹„í™œì„±í™” (PermitRootLogin = "no")
  users.users.root = {
    # ë°©ë²• 1: í•´ì‹œëœ ë¹„ë°€ë²ˆí˜¸ (ë” ì•ˆì „)
    # mkpasswd -m sha-512 ë¡œ ìƒì„±
    # initialHashedPassword = "$6$rounds=65536$...";

    # ë°©ë²• 2: í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸ (ê°„ë‹¨, Emergency ìš©ë„ë§Œ)
    initialPassword = "recovery-only-2025";  # Serial Console ì „ìš©
  };

  # Serial Console ë° Emergency Mode ê°œì„ 
  boot.kernelParams = [
    "console=tty0"           # ë¡œì»¬ ì½˜ì†”
    "console=ttyS0,115200"   # Serial console
    "systemd.log_level=debug"  # ë””ë²„ê¹… (ë¬¸ì œ ë°œìƒ ì‹œ)
  ];

  # Systemd emergency mode í™œì„±í™”
  systemd = {
    enableEmergencyMode = true;

    # Emergency shell íƒ€ì„ì•„ì›ƒ ì¦ê°€ (ê¸°ë³¸ 90ì´ˆ â†’ 300ì´ˆ)
    services."emergency".serviceConfig = {
      JobTimeoutSec = "5min";
    };
  };

  # (ì¤‘ìš”) SSHëŠ” ì—¬ì „íˆ root ë¡œê·¸ì¸ ì°¨ë‹¨
  services.openssh.settings = {
    PermitRootLogin = "no";  # SSHë¡œëŠ” root ì ‘ê·¼ ë¶ˆê°€
    PasswordAuthentication = false;
  };
}
#+end_src

*ë³´ì•ˆ ê³ ë ¤ì‚¬í•­*:
- Root ë¹„ë°€ë²ˆí˜¸ëŠ” Serial Console/Emergency Mode ì „ìš©
- SSHëŠ” ì—¬ì „íˆ ì¼ë°˜ ì‚¬ìš©ì + sudo ì‚¬ìš©
- ë³µêµ¬ ì™„ë£Œ í›„ =users.users.root.hashedPassword = "!";= ë¡œ ë‹¤ì‹œ ì ê¸ˆ ê°€ëŠ¥

*** ë°©ì•ˆ 4: Disko ì„¤ì • ê°œì„  (ìƒˆ ì„¤ì¹˜ ì‹œ ì ìš©)

#+begin_src nix
# hosts/oracle/disk-config.nix
{
  disko.devices = {
    disk = {
      main = {
        type = "disk";
        device = "/dev/sda";
        content = {
          type = "gpt";
          partitions = {
            boot = {
              size = "512M";
              type = "EF00";
              name = "disk-main-boot";  # ëª…ì‹œì  ë ˆì´ë¸” ì§€ì •
              content = {
                type = "filesystem";
                format = "vfat";
                mountpoint = "/boot";
                mountOptions = [ "defaults" ];
              };
            };
            root = {
              size = "100%";
              name = "disk-main-root";  # ëª…ì‹œì  ë ˆì´ë¸” ì§€ì •
              content = {
                type = "filesystem";
                format = "ext4";
                mountpoint = "/";
                mountOptions = [ "defaults" "noatime" ];
              };
            };
          };
        };
      };
    };
  };
}
#+end_src

** Oracle Cloud Volume ê´€ë¦¬ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤

*** Volume Resize ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸

#+begin_src bash
# 1. íŒŒí‹°ì…˜ ì •ë³´ ë°±ì—… (GPT í—¤ë” í¬í•¨)
sudo sgdisk --backup=/root/sda-partition-backup.sgdisk /dev/sda

# 2. íŒŒí‹°ì…˜ ë ˆì´ë¸” ëª©ë¡ ì €ì¥
sudo sgdisk -p /dev/sda > /root/sda-partition-info.txt

# 3. UUID ëª©ë¡ ì €ì¥
sudo blkid > /root/blkid-backup.txt

# 4. fstab ë°±ì—… (NixOSëŠ” ë¯¸ì‚¬ìš©ì´ì§€ë§Œ ì°¸ê³ ìš©)
sudo cp /etc/fstab /root/fstab.backup
#+end_src

*** Volume Resize í›„ í•„ìˆ˜ ì‘ì—…

#+begin_src bash
# 1. íŒŒí‹°ì…˜ ë ˆì´ë¸” í™•ì¸ ë° ë³µêµ¬
ls -la /dev/disk/by-partlabel/
# ë ˆì´ë¸”ì´ ì—†ìœ¼ë©´ ìœ„ "ë°©ì•ˆ 1" ì‹¤í–‰

# 2. íŒŒí‹°ì…˜ í™•ì¥ (ë£¨íŠ¸ íŒŒí‹°ì…˜)
sudo growpart /dev/sda 2  # cloud-utils íŒ¨í‚¤ì§€ í•„ìš”

# 3. íŒŒì¼ì‹œìŠ¤í…œ í™•ì¥
sudo resize2fs /dev/sda2  # ext4ì˜ ê²½ìš°

# 4. í™•ì¸
df -h /
lsblk
#+end_src

*** NixOS íŠ¹í™” ê³ ë ¤ì‚¬í•­

*Disko vs hardware-configuration.nix ì—­í•  êµ¬ë¶„*
- =disk-config.nix= (disko): ì´ˆê¸° ì„¤ì¹˜ ì‹œ ë””ìŠ¤í¬ íŒŒí‹°ì…”ë‹
- =hardware-configuration.nix=: ë¶€íŒ… ì‹œ íŒŒì¼ì‹œìŠ¤í…œ ë§ˆìš´íŠ¸
- *ì¶©ëŒ ì‹œ hardware-configuration.nixê°€ ìš°ì„  ì ìš©ë¨*

*ì¬í˜„ì„± vs ì•ˆì •ì„± íŠ¸ë ˆì´ë“œì˜¤í”„*
| ë°©ì‹              | ì¬í˜„ì„± | ì•ˆì •ì„± | Oracle Cloud ì í•©ë„ |
|-------------------+--------+--------+---------------------|
| Partition Label   | ë†’ìŒ   | ì¤‘ê°„   | ë‚®ìŒ (resize ìœ„í—˜)  |
| UUID              | ì¤‘ê°„   | ë†’ìŒ   | ë†’ìŒ (ê¶Œì¥)         |
| Device Path       | ë‚®ìŒ   | ë‚®ìŒ   | ë‚®ìŒ                |

** í–¥í›„ ì˜ˆë°© ì¡°ì¹˜

*** ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸

#+begin_src bash
#!/usr/bin/env bash
# ~/scripts/check-partition-labels.sh

echo "=== Partition Label ìƒíƒœ ì ê²€ ==="
echo

echo "1. íŒŒí‹°ì…˜ ë ˆì´ë¸” ì¡´ì¬ í™•ì¸:"
ls -la /dev/disk/by-partlabel/ 2>/dev/null || echo "ê²½ê³ : íŒŒí‹°ì…˜ ë ˆì´ë¸” ì—†ìŒ!"

echo
echo "2. í˜„ì¬ ë§ˆìš´íŠ¸ ìƒíƒœ:"
df -h / /boot

echo
echo "3. Diskoê°€ ê¸°ëŒ€í•˜ëŠ” ë ˆì´ë¸”:"
grep -r "by-partlabel" /etc/nixos/ 2>/dev/null || echo "(ë ˆì´ë¸” ì˜ì¡´ì„± ì—†ìŒ - OK)"

echo
echo "4. UUID ì •ë³´:"
sudo blkid /dev/sda1 /dev/sda2
#+end_src

*** Systemd ê²½ê³  ì„œë¹„ìŠ¤ (ì„ íƒì‚¬í•­)

#+begin_src nix
# configuration.nixì— ì¶”ê°€
systemd.services.partition-label-check = {
  description = "Check partition labels on boot";
  wantedBy = [ "multi-user.target" ];
  after = [ "local-fs.target" ];
  serviceConfig = {
    Type = "oneshot";
    ExecStart = pkgs.writeShellScript "check-labels" ''
      if [ ! -e /dev/disk/by-partlabel/disk-main-root ]; then
        echo "ê²½ê³ : disk-main-root ë ˆì´ë¸” ì†ì‹¤ë¨!" | systemd-cat -t partition-check -p warning
      fi
    '';
  };
};
#+end_src

** ì°¸ê³  ìë£Œ

- [[https://github.com/nix-community/disko][Disko GitHub Repository]]
- [[https://docs.oracle.com/en-us/iaas/Content/Block/Tasks/resizingavolume.htm][Oracle Cloud: Resizing a Volume]]
- [[https://nixos.org/manual/nixos/stable/#sec-installation-manual-partitioning][NixOS Manual: Partitioning]]
- [[https://www.rodsbooks.com/gdisk/][GPT fdisk (gdisk) Documentation]]

** íƒ€ì„ë¼ì¸

- [2025-10-25 Fri 16:21] ë¬¸ì„œ ì‘ì„±
- [2025-10-25 Fri] ë¬¸ì œ ë°œê²¬ ë° ë¶„ì„
- [ì˜ˆì •] ë°©ì•ˆ 2 (UUID ì „í™˜) ì ìš©

** ë©”íƒ€ë°ì´í„°
- ì‘ì„±ì: Claude Code + Junghan
- ì¹´í…Œê³ ë¦¬: Troubleshooting / Infrastructure
- ìš°ì„ ìˆœìœ„: High (í”„ë¡œë•ì…˜ ì‹œìŠ¤í…œ ë¶€íŒ… ë¶ˆê°€)
- ìƒíƒœ: ë¶„ì„ ì™„ë£Œ, í•´ê²° ëŒ€ê¸°
